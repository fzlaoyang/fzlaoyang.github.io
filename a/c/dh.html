<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="网址导航,绿色无广告,福州老杨" />
<meta name="description" content="福州老杨的网址导航 - 绿色无广告，集合常用网站、电影音乐、AI工具和优质资源，上网从这里开始" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="index,follow" />
<meta name="author" content="福州老杨" />
<title>网址导航 - 绿色无广告，上网从这里开始</title>
<link rel="stylesheet" type="text/css" href="daohang.css" />
<base target="_blank">
</head>
<body>
<div id="top-actions">
    <a href="javascript:window.external.AddFavorite('http://oyang.cn', '福州老杨的仓库')" title="收藏本页">收藏网页</a>
    <a href="javascript:document.body.style.behavior='url(#default#homepage)';document.body.setHomePage('http://oyang.cn')" title="设为首页">设为首页</a>
</div>
<div id="container">
    <div id="header" class="clearfix">
        <h1>网址导航</h1>
        <div id="search">
            <input type="text" id="search-input" value="请输入关键词搜索" onfocus="if(this.value=='请输入关键词搜索')this.value='';" onblur="if(this.value=='')this.value='请输入关键词搜索';" />
            <button onclick="searchSite()">搜索</button>
        </div>
    </div>
    <div id="collapse-controls">
        <button id="expand-all">全部展开</button>
        <button id="collapse-all">全部折叠</button>
        <span>提示：点击分类标题可单独展开/折叠</span>
    </div>
    <div id="categories-container">
        <div class="loading">加载中...</div>
    </div>
    <div id="footer">
        <p><a href="/">首页</a> | <a href="/about">关于我们</a> | <a href="#">网址提交</a> | <a href="/about">联系我们</a></p>
        <p style="font-family:arial;">Copyright © 2025 ooyang.cn</p>
    </div>
</div>
<script type="text/javascript">
var originalHTML = {};
var siteData = null;

window.onload = function() {
    // 加载数据
    loadData();
    
    // 初始化搜索事件
    document.getElementById('search-input').onkeydown = function(e) {
        if (e.keyCode == 13) searchSite();
    };
};

// 从JSON文件加载数据
function loadData() {
    fetch('data.json')
        .then(response => {
            if (!response.ok) {
                throw new Error('网络响应不正常');
            }
            return response.json();
        })
        .then(data => {
            siteData = data;
            renderCategories();
            initCategories();
            saveOriginalContent();
        })
        .catch(error => {
            document.getElementById('categories-container').innerHTML = 
                `<div class="loading">数据加载失败: ${error.message}</div>`;
            console.error('加载数据出错:', error);
        });
}

// 渲染分类内容
function renderCategories() {
    const container = document.getElementById('categories-container');
    container.innerHTML = '';
    
    siteData.categories.forEach(category => {
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'category';
        categoryDiv.dataset.id = category.id;
        
        // 创建标题
        const title = document.createElement('h2');
        title.innerHTML = `${category.name} <span>-</span>`;
        categoryDiv.appendChild(title);
        
        // 创建链接容器
        const linksContainer = document.createElement('div');
        linksContainer.className = category.sections ? 'links-grid' : 'links-list';
        
        // 处理带分区的分类
        if (category.sections) {
            category.sections.forEach(section => {
                if (section.title) {
                    const sectionTitle = document.createElement('span');
                    sectionTitle.className = 'h3new';
                    sectionTitle.textContent = section.title;
                    linksContainer.appendChild(sectionTitle);
                }
                
                section.links.forEach(link => {
                    const a = document.createElement('a');
                    a.href = link.url;
                    a.textContent = link.name;
                    linksContainer.appendChild(a);
                });
                
                linksContainer.appendChild(document.createElement('br'));
            });
        }
        // 处理ED2K链接
        else if (category.ed2kItems) {
            category.ed2kItems.forEach(item => {
                const ed2kDiv = document.createElement('div');
                ed2kDiv.className = 'ed2k-item';
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = item.name;
                
                const copyBtn = document.createElement('span');
                copyBtn.className = 'copy-btn';
                copyBtn.textContent = '复制地址';
                copyBtn.onclick = () => copyEd2k(item.url);
                
                const tooltip = document.createElement('span');
                tooltip.className = 'tooltip';
                
                ed2kDiv.appendChild(nameSpan);
                ed2kDiv.appendChild(copyBtn);
                ed2kDiv.appendChild(tooltip);
                linksContainer.appendChild(ed2kDiv);
            });
        }
        // 处理普通链接列表
        else if (category.links) {
            category.links.forEach(link => {
                const a = document.createElement('a');
                a.href = link.url;
                a.textContent = link.name;
                linksContainer.appendChild(a);
            });
        }
        
        categoryDiv.appendChild(linksContainer);
        container.appendChild(categoryDiv);
    });
}

// 初始化分类展开/折叠功能
function initCategories() {
    const categories = document.getElementsByClassName('category');
    const expandAllBtn = document.getElementById('expand-all');
    const collapseAllBtn = document.getElementById('collapse-all');
    
    // 为每个分类标题添加点击事件
    for (let i = 0; i < categories.length; i++) {
        const header = categories[i].getElementsByTagName('h2')[0];
        const symbol = header.getElementsByTagName('span')[0];
        
        header.onclick = function() {
            const category = this.parentNode;
            const symbol = this.getElementsByTagName('span')[0];
            
            if (category.classList.contains('collapsed')) {
                category.classList.remove('collapsed');
                symbol.innerHTML = '-';
            } else {
                category.classList.add('collapsed');
                symbol.innerHTML = '+';
            }
        };
    }
    
    // 全部展开
    expandAllBtn.onclick = function() {
        for (let i = 0; i < categories.length; i++) {
            const category = categories[i];
            const symbol = category.getElementsByTagName('span')[0];
            category.classList.remove('collapsed');
            symbol.innerHTML = '-';
        }
    };
    
    // 全部折叠
    collapseAllBtn.onclick = function() {
        for (let i = 0; i < categories.length; i++) {
            const category = categories[i];
            const symbol = category.getElementsByTagName('span')[0];
            category.classList.add('collapsed');
            symbol.innerHTML = '+';
        }
    };
}

// 保存原始内容用于重置搜索
function saveOriginalContent() {
    const links = document.querySelectorAll('.links-grid, .links-list');
    for (let i = 0; i < links.length; i++) {
        originalHTML[links[i].className + i] = links[i].innerHTML;
    }
}

// 搜索功能
function searchSite() {
    const searchTerm = document.getElementById('search-input').value.trim().toLowerCase();
    if (searchTerm === '' || searchTerm === '请输入关键词搜索') {
        resetSearch();
        return;
    }
    
    resetSearch();
    let found = false;
    const categories = document.getElementsByClassName('category');
    
    for (let i = 0; i < categories.length; i++) {
        const category = categories[i];
        const linksContainer = category.querySelector('.links-grid, .links-list');
        const elements = linksContainer.querySelectorAll('a, span.h3new, .ed2k-item span:first-child');
        let hasMatch = false;
        
        for (let j = 0; j < elements.length; j++) {
            const element = elements[j];
            const text = element.textContent.toLowerCase();
            
            if (element.tagName === 'A' && element.getAttribute('href') && element.getAttribute('href').startsWith('ed2k://')) {
                continue;
            }
            
            if (text.indexOf(searchTerm) !== -1) {
                hasMatch = true;
                found = true;
                const originalText = element.innerHTML;
                const regex = new RegExp('(' + searchTerm + ')', 'gi');
                element.innerHTML = originalText.replace(regex, '<span class="highlight">$1</span>');
            }
        }
        
        if (hasMatch) {
            category.classList.remove('collapsed');
            category.getElementsByTagName('span')[0].innerHTML = '-';
        } else {
            category.classList.add('collapsed');
            category.getElementsByTagName('span')[0].innerHTML = '+';
        }
    }
    
    if (!found) {
        alert('没有找到与 "' + searchTerm + '" 相关的内容');
    }
}

// 重置搜索
function resetSearch() {
    const links = document.querySelectorAll('.links-grid, .links-list');
    for (let i = 0; i < links.length; i++) {
        links[i].innerHTML = originalHTML[links[i].className + i];
    }
}

// 复制ED2K地址
function copyEd2k(ed2kUrl) {
    const tempInput = document.createElement('input');
    document.body.appendChild(tempInput);
    tempInput.value = ed2kUrl;
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);
    
    // 显示提示
    const tooltip = event.target.nextElementSibling;
    tooltip.textContent = '已复制到剪贴板！';
    tooltip.style.backgroundColor = '#dff0d8';
    tooltip.style.color = '#3c763d';
    tooltip.style.display = 'inline-block';
    
    setTimeout(() => {
        tooltip.textContent = '';
        tooltip.style.display = 'none';
    }, 3000);
}
</script>
</body>
</html>