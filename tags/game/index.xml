<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Game on Á¶èÂ∑ûËÄÅÊù®</title>
    <link>https://ooyang.cn/tags/game/</link>
    <description>Recent content in Game on Á¶èÂ∑ûËÄÅÊù®</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <copyright>Copyright ¬© 2022-2025, BG5VGE.</copyright>
    <lastBuildDate>Sun, 04 Jan 2026 11:00:00 +0800</lastBuildDate>
    <atom:link href="https://ooyang.cn/tags/game/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>È≠ÇÊñóÁΩó1</title>
      <link>https://ooyang.cn/game/contra.htm</link>
      <pubDate>Sun, 04 Jan 2026 11:00:00 +0800</pubDate>
      <guid>https://ooyang.cn/game/contra.htm</guid>
      <description>&lt;style&gt;&#xD;&#xA;:root {--gap: 10px;}&#xD;&#xA;.bar {display: flex;gap: var(--gap);align-items: center;flex-wrap: wrap;}&#xD;&#xA;label.btn,&#xD;&#xA;button,&#xD;&#xA;a.btn {padding: 6px 10px;border: 1px solid #ddd;border-radius: 8px;background: #f7f7f7;cursor: pointer;text-decoration: none;color: #111;}&#xD;&#xA;.btn-toggle.on {background: #e9f7ff;border-color: #9ad4ff;}&#xD;&#xA;.status {color: #555}&#xD;&#xA;.err {color: #b00020}&#xD;&#xA;#stage {margin-top: 12px;display: grid;place-items: center;outline: none;position: relative;}&#xD;&#xA;canvas {&#xD;&#xA;  image-rendering: pixelated;&#xD;&#xA;  border: 1px solid #eee;&#xD;&#xA;  border-radius: 10px;&#xD;&#xA;  box-shadow: 0 6px 20px rgba(0, 0, 0, .08);&#xD;&#xA;  background: #000;&#xD;&#xA;}&#xD;&#xA;.group {display: flex;align-items: center;gap: 6px;}&#xD;&#xA;select,&#xD;&#xA;input[type=&#34;range&#34;] {padding: 2px 4px;}&#xD;&#xA;.crt::after {content: &#34;&#34;;position: absolute;inset: 0;pointer-events: none;background: repeating-linear-gradient(to bottom, rgba(0, 0, 0, .15) 0, rgba(0, 0, 0, .15) 1px, transparent 2px, transparent 3px);&#xD;&#xA;  mix-blend-mode: multiply;border-radius: 10px;}&#xD;&#xA;.modal-backdrop {position: fixed;inset: 0;background: rgba(0, 0, 0, .4);display: none;align-items: center;  justify-content: center;z-index: 999;}&#xD;&#xA;.modal {background: #fff;border-radius: 12px;box-shadow: 0 10px 40px rgba(0, 0, 0, .2);padding: 16px;max-width: 720px;  width: calc(100% - 32px);}&#xD;&#xA;.modal h3 {margin: 0 0 8px}&#xD;&#xA;.grid {display: grid;grid-template-columns: 1fr 1fr;gap: 8px;}&#xD;&#xA;.row {display: flex;gap: 8px;align-items: center;justify-content: space-between;border: 1px dashed #eee;padding: 6px 8px;border-radius: 8px;}&#xD;&#xA;.kbd {font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, &#34;Liberation Mono&#34;, monospace;background: #f3f3f3;border-radius: 6px;padding: 3px 6px;border: 1px solid #e5e5e5;}&#xD;&#xA;.tip {color: #666;font-size: 12px;}&#xD;&#xA;.modal .footer {display: flex;justify-content: flex-end;gap: 8px;margin-top: 10px;}&#xD;&#xA;.drop-hint {position: fixed;inset: 0;display: none;align-items: center;justify-content: center;background: rgba(30, 144, 255, .12);border: 3px dashed #1e90ff;color: #1e90ff;font-weight: 600;font-size: 20px;z-index: 998;}&#xD;&#xA;  &lt;/style&gt;&#xD;&#xA;  &lt;div class=&#34;bar&#34;&gt;&#xD;&#xA;    &lt;label class=&#34;btn&#34;&gt;ÈÄâÊã©ROM&lt;input id=&#34;rom&#34; type=&#34;file&#34; accept=&#34;.nes&#34; hidden&gt;&lt;/label&gt;&#xD;&#xA;&#x9;&lt;a href=&#34;#&#34; class=&#34;btn&#34; id=&#34;demoRom&#34; data-rom-url=&#34;contra.nes&#34; data-rom-name=&#34;contra.nes&#34;&gt;È≠ÇÊñóÁΩó1&lt;/a&gt;&#xD;&#xA;    &lt;a href=&#34;#&#34; class=&#34;btn&#34; id=&#34;demoRom&#34; data-rom-url=&#34;tank.nes&#34; data-rom-name=&#34;tank.nes&#34;&gt;Âù¶ÂÖã&lt;/a&gt;&#xD;&#xA;    &lt;a href=&#34;#&#34; class=&#34;btn&#34; id=&#34;demoRom&#34; data-rom-url=&#34;1943.nes&#34; data-rom-name=&#34;1943.nes&#34;&gt;1943&lt;/a&gt;&#xD;&#xA;    &lt;button id=&#34;toggle&#34; disabled&gt;ÂºÄÂßã&lt;/button&gt;&#xD;&#xA;    &lt;button id=&#34;reset&#34; disabled&gt;Â§ç‰Ωç&lt;/button&gt;&#xD;&#xA;    &lt;div class=&#34;group&#34;&gt;&#xD;&#xA;      &lt;button id=&#34;mute&#34; class=&#34;btn-toggle&#34;&gt;üîà ÈùôÈü≥&lt;/button&gt;&#xD;&#xA;      &lt;label&gt;Èü≥Èáè &lt;input id=&#34;vol&#34; type=&#34;range&#34; min=&#34;0&#34; max=&#34;100&#34; value=&#34;100&#34;&gt;&lt;/label&gt;&#xD;&#xA;      &lt;button id=&#34;screenshot&#34;&gt;üì∑ Êà™Âõæ&lt;/button&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;    &lt;div class=&#34;group&#34;&gt;&#xD;&#xA;      &lt;label&gt;ÊòæÁ§∫ÂÄçÊï∞&#xD;&#xA;        &lt;select id=&#34;scale&#34;&gt;&#xD;&#xA;          &lt;option value=&#34;1&#34;&gt;1√ó&lt;/option&gt;&#xD;&#xA;          &lt;option value=&#34;2&#34; selected&gt;2√ó&lt;/option&gt;&#xD;&#xA;          &lt;option value=&#34;3&#34;&gt;3√ó&lt;/option&gt;&#xD;&#xA;          &lt;option value=&#34;4&#34;&gt;4√ó&lt;/option&gt;&#xD;&#xA;        &lt;/select&gt;&#xD;&#xA;      &lt;/label&gt;&#xD;&#xA;      &lt;button id=&#34;fit&#34;&gt;Ëá™ÈÄÇÂ∫î&lt;/button&gt;&#xD;&#xA;      &lt;button id=&#34;fs&#34;&gt;‚õ∂ ÂÖ®Â±è&lt;/button&gt;&#xD;&#xA;      &lt;button id=&#34;crt&#34; class=&#34;btn-toggle&#34;&gt;üì∫ CRT&lt;/button&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;    &lt;div class=&#34;group&#34;&gt;&#xD;&#xA;      &lt;label&gt;ÈÄüÂ∫¶&#xD;&#xA;        &lt;select id=&#34;speed&#34;&gt;&#xD;&#xA;          &lt;option value=&#34;0.5&#34;&gt;0.5√ó&lt;/option&gt;&#xD;&#xA;          &lt;option value=&#34;1&#34; selected&gt;1√ó&lt;/option&gt;&#xD;&#xA;          &lt;option value=&#34;2&#34;&gt;2√ó&lt;/option&gt;&#xD;&#xA;          &lt;option value=&#34;3&#34;&gt;3√ó&lt;/option&gt;&#xD;&#xA;          &lt;option value=&#34;4&#34;&gt;4√ó&lt;/option&gt;&#xD;&#xA;        &lt;/select&gt;&#xD;&#xA;      &lt;/label&gt;&#xD;&#xA;      &lt;span class=&#34;tip&#34;&gt;Êåâ‰Ωè &lt;span class=&#34;kbd&#34;&gt;Tab&lt;/span&gt; ‰∏¥Êó∂Âø´ËøõÔºà√ó2 ÂΩìÂâçÈÄüÂ∫¶ÔºåÊúÄÈ´ò √ó6Ôºâ&lt;/span&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;    &lt;div class=&#34;group&#34;&gt;&#xD;&#xA;      &lt;button id=&#34;swap&#34; class=&#34;btn-toggle on&#34;&gt;üé® Ëâ≤ÂΩ©‰øÆÊ≠£&lt;/button&gt;&#xD;&#xA;      &lt;button id=&#34;cfgKeysP1&#34;&gt;‚å®Ô∏è P1 ÈîÆÁõòÊò†Â∞Ñ&lt;/button&gt;&#xD;&#xA;      &lt;button id=&#34;cfgKeysP2&#34;&gt;‚å®Ô∏è P2 ÈîÆÁõòÊò†Â∞Ñ&lt;/button&gt;&#xD;&#xA;      &lt;button id=&#34;cfgPadP1&#34;&gt;üéÆ P1 ÊâãÊüÑÊò†Â∞Ñ&lt;/button&gt;&#xD;&#xA;      &lt;button id=&#34;cfgPadP2&#34;&gt;üéÆ P2 ÊâãÊüÑÊò†Â∞Ñ&lt;/button&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;    &lt;div class=&#34;group&#34;&gt;&#xD;&#xA;      &lt;label&gt;Â≠òÊ°£ÊßΩ&lt;select id=&#34;slot&#34;&gt;&#xD;&#xA;          &lt;option value=&#34;0&#34;&gt;#1&lt;/option&gt;&#xD;&#xA;          &lt;option value=&#34;1&#34;&gt;#2&lt;/option&gt;&#xD;&#xA;          &lt;option value=&#34;2&#34;&gt;#3&lt;/option&gt;&#xD;&#xA;        &lt;/select&gt;&lt;/label&gt;&#xD;&#xA;      &lt;button id=&#34;saveState&#34;&gt;üíæ ‰øùÂ≠ò&lt;/button&gt;&#xD;&#xA;      &lt;button id=&#34;loadState&#34;&gt;üìÇ ËØªÂèñ&lt;/button&gt;&#xD;&#xA;      &lt;button id=&#34;clearState&#34;&gt;üóëÔ∏è Ê∏ÖÈô§&lt;/button&gt;&#xD;&#xA;      &lt;button id=&#34;exportState&#34;&gt;‚¨áÔ∏è ÂØºÂá∫&lt;/button&gt;&#xD;&#xA;      &lt;label class=&#34;btn&#34;&gt;ÂØºÂÖ•&lt;input id=&#34;importState&#34; type=&#34;file&#34; accept=&#34;.json,.state.json,application/json&#34; hidden&gt;&lt;/label&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;    &lt;div class=&#34;group&#34;&gt;&#xD;&#xA;      &lt;button id=&#34;recStart&#34;&gt;‚è∫ ÂºÄÂßãÂΩïÂà∂&lt;/button&gt;&#xD;&#xA;      &lt;button id=&#34;recStop&#34; disabled&gt;‚èπ ÂÅúÊ≠¢ÂΩïÂà∂&lt;/button&gt;&#xD;&#xA;      &lt;a id=&#34;recDownload&#34; style=&#34;display:none&#34; download=&#34;recording.webm&#34;&gt;‚¨áÔ∏è ‰∏ãËΩΩËßÜÈ¢ë&lt;/a&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;    &lt;span class=&#34;status&#34; id=&#34;romName&#34;&gt;Êú™Âä†ËΩΩ&lt;/span&gt;&#xD;&#xA;    &lt;span class=&#34;status&#34; id=&#34;fps&#34;&gt;FPS: --&lt;/span&gt;&#xD;&#xA;    &lt;span class=&#34;err&#34; id=&#34;err&#34;&gt;&lt;/span&gt;&#xD;&#xA;  &lt;/div&gt;&#xD;&#xA;  &lt;div id=&#34;stage&#34; tabindex=&#34;0&#34;&gt;&lt;canvas id=&#34;screen&#34; width=&#34;256&#34; height=&#34;240&#34;&gt;&lt;/canvas&gt;&lt;/div&gt;&#xD;&#xA;  &lt;!-- ÈîÆÁõòÊò†Â∞Ñ --&gt;&#xD;&#xA;  &lt;div id=&#34;modalKeys&#34; class=&#34;modal-backdrop&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;modal&#34;&gt;&#xD;&#xA;      &lt;h3 id=&#34;keysTitle&#34;&gt;ÈîÆÁõòÊò†Â∞Ñ&lt;/h3&gt;&#xD;&#xA;      &lt;div class=&#34;grid&#34; id=&#34;keyGrid&#34;&gt;&lt;/div&gt;&#xD;&#xA;      &lt;div class=&#34;tip&#34;&gt;ÁÇπÂáªÊüêÈ°πÂêéÊåâ‰Ω†ÊÉ≥ÁªëÂÆöÁöÑÈîÆÔºõÊò†Â∞Ñ‰øùÂ≠òÂà∞ÊµèËßàÂô®ÔºàÂêÑÁé©ÂÆ∂Áã¨Á´ãÔºâ„ÄÇ&lt;/div&gt;&#xD;&#xA;      &lt;div class=&#34;footer&#34;&gt;&#xD;&#xA;        &lt;button id=&#34;restoreKeyDefault&#34;&gt;ÊÅ¢Â§çÈªòËÆ§&lt;/button&gt;&#xD;&#xA;        &lt;button id=&#34;closeKeys&#34;&gt;ÂÖ≥Èó≠&lt;/button&gt;&#xD;&#xA;      &lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;  &lt;/div&gt;&#xD;&#xA;  &lt;!-- ÊâãÊüÑÊò†Â∞Ñ --&gt;&#xD;&#xA;  &lt;div id=&#34;modalPad&#34; class=&#34;modal-backdrop&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;modal&#34;&gt;&#xD;&#xA;      &lt;h3 id=&#34;padTitle&#34;&gt;ÊâãÊüÑÊò†Â∞Ñ&lt;/h3&gt;&#xD;&#xA;      &lt;div class=&#34;tip&#34;&gt;ËøûÊé•ÊâãÊüÑÂêéÁÇπ‚ÄúÊçïÊçâ‚ÄùÂπ∂Êåâ‰∏ãÊâãÊüÑÊåâÈíÆ/ÊñπÂêëÔºõP1=ÊâãÊüÑ0ÔºåP2=ÊâãÊüÑ1„ÄÇ&lt;/div&gt;&#xD;&#xA;      &lt;div id=&#34;padGrid&#34;&gt;&lt;/div&gt;&#xD;&#xA;      &lt;div class=&#34;footer&#34;&gt;&#xD;&#xA;        &lt;button id=&#34;restorePadDefault&#34;&gt;ÊÅ¢Â§çÈªòËÆ§&lt;/button&gt;&#xD;&#xA;        &lt;button id=&#34;closePad&#34;&gt;ÂÖ≥Èó≠&lt;/button&gt;&#xD;&#xA;      &lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;  &lt;/div&gt;&#xD;&#xA;  &lt;div id=&#34;dropHint&#34; class=&#34;drop-hint&#34;&gt;ÊãñÊîæ .nes Êàñ .state.json Âà∞Ê≠§&lt;/div&gt;&#xD;&#xA;  &lt;script src=&#34;https://unpkg.com/jsnes/dist/jsnes.min.js&#34;&gt;&lt;/script&gt;&#xD;&#xA;  &lt;script&gt;&#xD;&#xA;    (function() {&#xD;&#xA;      // ------- DOM -------&#xD;&#xA;      const stage = document.getElementById(&#39;stage&#39;);&#xD;&#xA;      const canvas = document.getElementById(&#39;screen&#39;),&#xD;&#xA;        ctx = canvas.getContext(&#39;2d&#39;);&#xD;&#xA;      const romNameEl = document.getElementById(&#39;romName&#39;),&#xD;&#xA;        fpsEl = document.getElementById(&#39;fps&#39;),&#xD;&#xA;        errEl = document.getElementById(&#39;err&#39;);&#xD;&#xA;      const romInput = document.getElementById(&#39;rom&#39;);&#xD;&#xA;      const btnStart = document.getElementById(&#39;toggle&#39;),&#xD;&#xA;        btnReset = document.getElementById(&#39;reset&#39;);&#xD;&#xA;      const btnMute = document.getElementById(&#39;mute&#39;),&#xD;&#xA;        volEl = document.getElementById(&#39;vol&#39;);&#xD;&#xA;      const scaleSel = document.getElementById(&#39;scale&#39;),&#xD;&#xA;        fitBtn = document.getElementById(&#39;fit&#39;),&#xD;&#xA;        fsBtn = document.getElementById(&#39;fs&#39;);&#xD;&#xA;      const btnSwap = document.getElementById(&#39;swap&#39;),&#xD;&#xA;        btnCrt = document.getElementById(&#39;crt&#39;),&#xD;&#xA;        btnShot = document.getElementById(&#39;screenshot&#39;);&#xD;&#xA;      const speedSel = document.getElementById(&#39;speed&#39;);&#xD;&#xA;      const slotSel = document.getElementById(&#39;slot&#39;),&#xD;&#xA;        saveBtn = document.getElementById(&#39;saveState&#39;),&#xD;&#xA;        loadBtn = document.getElementById(&#39;loadState&#39;),&#xD;&#xA;        clearBtn = document.getElementById(&#39;clearState&#39;);&#xD;&#xA;      const exportBtn = document.getElementById(&#39;exportState&#39;),&#xD;&#xA;        importInp = document.getElementById(&#39;importState&#39;);&#xD;&#xA;      const recStartBtn = document.getElementById(&#39;recStart&#39;),&#xD;&#xA;        recStopBtn = document.getElementById(&#39;recStop&#39;),&#xD;&#xA;        recDL = document.getElementById(&#39;recDownload&#39;);&#xD;&#xA;      const modalKeys = document.getElementById(&#39;modalKeys&#39;),&#xD;&#xA;        keyGrid = document.getElementById(&#39;keyGrid&#39;),&#xD;&#xA;        keysTitle = document.getElementById(&#39;keysTitle&#39;),&#xD;&#xA;        restoreKeyDefault = document.getElementById(&#39;restoreKeyDefault&#39;),&#xD;&#xA;        closeKeys = document.getElementById(&#39;closeKeys&#39;);&#xD;&#xA;      const modalPad = document.getElementById(&#39;modalPad&#39;),&#xD;&#xA;        padGrid = document.getElementById(&#39;padGrid&#39;),&#xD;&#xA;        padTitle = document.getElementById(&#39;padTitle&#39;),&#xD;&#xA;        restorePadDefault = document.getElementById(&#39;restorePadDefault&#39;),&#xD;&#xA;        closePad = document.getElementById(&#39;closePad&#39;);&#xD;&#xA;      const dropHint = document.getElementById(&#39;dropHint&#39;);&#xD;&#xA;      // ------- NES &amp; Áä∂ÊÄÅ -------&#xD;&#xA;      let nes = null,&#xD;&#xA;        running = false,&#xD;&#xA;        rafId = null;&#xD;&#xA;      let pausedByVisibility = false,&#xD;&#xA;        warmResumedOnce = false;&#xD;&#xA;      const imageData = new ImageData(new Uint8ClampedArray(256 * 240 * 4), 256, 240);&#xD;&#xA;      let swapRB = true;&#xD;&#xA;      const AC = window.AudioContext || window.webkitAudioContext;&#xD;&#xA;      let audioCtx = null,&#xD;&#xA;        proc = null,&#xD;&#xA;        qL = [],&#xD;&#xA;        qR = [],&#xD;&#xA;        muted = false,&#xD;&#xA;        volume = 1.0;&#xD;&#xA;      const SAMPLES = 512; // ÊóßËÆæÂ§áÂèØÊîπÂõû 1024&#xD;&#xA;      let mediaDest = null,&#xD;&#xA;        mediaStream = null,&#xD;&#xA;        recorder = null,&#xD;&#xA;        recChunks = [];&#xD;&#xA;      let lastRomU8 = null,&#xD;&#xA;        lastRomStr = null; // ÂΩìÂâçÊ∏∏ÊàèÁöÑ‰∏§ÁßçÂ≠òÂÇ®ÂΩ¢Âºè&#xD;&#xA;      let frames = 0,&#xD;&#xA;        lastTS = performance.now(),&#xD;&#xA;        speed = 1,&#xD;&#xA;        turboHeld = false,&#xD;&#xA;        lastMult = 1,&#xD;&#xA;        frameAcc = 0;&#xD;&#xA;      // ÂàÜÂ∏ßÈ¢ÑÁÉ≠ &amp; ÈòüÂàóÈôêÊµÅ&#xD;&#xA;      let warming = false;&#xD;&#xA;      const MAX_QUEUE = 16384;&#xD;&#xA;      const WARMUP_TOTAL = 48;&#xD;&#xA;      // ------- ËæìÂÖ•Êò†Â∞Ñ -------&#xD;&#xA;      const C = window.jsnes.Controller;&#xD;&#xA;      const NES_BUTTONS = [&#xD;&#xA;        [&#39;‰∏ä&#39;, C.BUTTON_UP],&#xD;&#xA;        [&#39;‰∏ã&#39;, C.BUTTON_DOWN],&#xD;&#xA;        [&#39;Â∑¶&#39;, C.BUTTON_LEFT],&#xD;&#xA;        [&#39;Âè≥&#39;, C.BUTTON_RIGHT],&#xD;&#xA;        [&#39;A&#39;, C.BUTTON_A],&#xD;&#xA;        [&#39;B&#39;, C.BUTTON_B],&#xD;&#xA;        [&#39;SELECT&#39;, C.BUTTON_SELECT],&#xD;&#xA;        [&#39;START&#39;, C.BUTTON_START]&#xD;&#xA;      ];&#xD;&#xA;      const defaultKeyMapP1 = {&#xD;&#xA;        UP: &#39;ArrowUp&#39;,&#xD;&#xA;        DOWN: &#39;ArrowDown&#39;,&#xD;&#xA;        LEFT: &#39;ArrowLeft&#39;,&#xD;&#xA;        RIGHT: &#39;ArrowRight&#39;,&#xD;&#xA;        A: &#39;KeyZ&#39;,&#xD;&#xA;        B: &#39;KeyX&#39;,&#xD;&#xA;        SELECT: &#39;ShiftLeft&#39;,&#xD;&#xA;        START: &#39;Enter&#39;&#xD;&#xA;      };&#xD;&#xA;      const defaultKeyMapP2 = {&#xD;&#xA;        UP: &#39;KeyW&#39;,&#xD;&#xA;        DOWN: &#39;KeyS&#39;,&#xD;&#xA;        LEFT: &#39;KeyA&#39;,&#xD;&#xA;        RIGHT: &#39;KeyD&#39;,&#xD;&#xA;        A: &#39;KeyK&#39;,&#xD;&#xA;        B: &#39;KeyJ&#39;,&#xD;&#xA;        SELECT: &#39;ShiftRight&#39;,&#xD;&#xA;        START: &#39;Backspace&#39;&#xD;&#xA;      };&#xD;&#xA;      let keyMapP1 = loadJSON(&#39;jsnes_keymap_p1&#39;, defaultKeyMapP1);&#xD;&#xA;      let keyMapP2 = loadJSON(&#39;jsnes_keymap_p2&#39;, defaultKeyMapP2);&#xD;&#xA;      let pressedP1 = new Set(),&#xD;&#xA;        pressedP2 = new Set();&#xD;&#xA;      const defaultPadMap = {&#xD;&#xA;        AXIS_H: 0,&#xD;&#xA;        AXIS_V: 1,&#xD;&#xA;        AXIS_THRESH: 0.4,&#xD;&#xA;        BTN_A: 0,&#xD;&#xA;        BTN_B: 1,&#xD;&#xA;        ALT_A: 2,&#xD;&#xA;        ALT_B: 3,&#xD;&#xA;        BTN_SELECT: 8,&#xD;&#xA;        BTN_START: 9,&#xD;&#xA;        DPAD_UP: 12,&#xD;&#xA;        DPAD_DOWN: 13,&#xD;&#xA;        DPAD_LEFT: 14,&#xD;&#xA;        DPAD_RIGHT: 15&#xD;&#xA;      };&#xD;&#xA;      let padMapP1 = loadJSON(&#39;jsnes_padmap_p1&#39;, defaultPadMap);&#xD;&#xA;      let padMapP2 = loadJSON(&#39;jsnes_padmap_p2&#39;, defaultPadMap);&#xD;&#xA;      let padPrevP1 = stateObj(false),&#xD;&#xA;        padPrevP2 = stateObj(false);&#xD;&#xA;      const STATE_PREFIX = &#39;jsnes_state_slot_&#39;;&#xD;&#xA;&#xD;&#xA;      function stateObj(v) {&#xD;&#xA;        return {&#xD;&#xA;          UP: v,&#xD;&#xA;          DOWN: v,&#xD;&#xA;          LEFT: v,&#xD;&#xA;          RIGHT: v,&#xD;&#xA;          A: v,&#xD;&#xA;          B: v,&#xD;&#xA;          SELECT: v,&#xD;&#xA;          START: v&#xD;&#xA;        };&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function isNon1x() {&#xD;&#xA;        return turboHeld || speed !== 1;&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function clearAudioQueue() {&#xD;&#xA;        qL.length = 0;&#xD;&#xA;        qR.length = 0;&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function toast(msg) {&#xD;&#xA;        errEl.textContent = msg;&#xD;&#xA;        setTimeout(() =&gt; {&#xD;&#xA;          if (errEl.textContent === msg) errEl.textContent = &#39;&#39;;&#xD;&#xA;        }, 2000);&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function loadJSON(k, def) {&#xD;&#xA;        try {&#xD;&#xA;          const v = localStorage.getItem(k);&#xD;&#xA;          return v ? JSON.parse(v) : def;&#xD;&#xA;        } catch {&#xD;&#xA;          return def;&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function saveJSON(k, obj) {&#xD;&#xA;        try {&#xD;&#xA;          localStorage.setItem(k, JSON.stringify(obj));&#xD;&#xA;        } catch {}&#xD;&#xA;      }&#xD;&#xA;      // ------- ÂàÜÂ∏ßÈ¢ÑÁÉ≠ -------&#xD;&#xA;      function warmUpFrames(total = WARMUP_TOTAL, perTick = 8, done) {&#xD;&#xA;        let left = total;&#xD;&#xA;&#xD;&#xA;        function tick() {&#xD;&#xA;          const n = Math.min(perTick, left);&#xD;&#xA;          try {&#xD;&#xA;            for (let i = 0; i &lt; n; i++) nes.frame();&#xD;&#xA;          } catch (e) {&#xD;&#xA;            console.warn(&#39;warmup error:&#39;, e);&#xD;&#xA;            left = 0;&#xD;&#xA;          }&#xD;&#xA;          left -= n;&#xD;&#xA;          if (left &gt; 0) requestAnimationFrame(tick);&#xD;&#xA;          else if (typeof done === &#39;function&#39;) done();&#xD;&#xA;        }&#xD;&#xA;        requestAnimationFrame(tick);&#xD;&#xA;      }&#xD;&#xA;      // ------- ÈáçÂª∫Èü≥È¢ëÈìæ -------&#xD;&#xA;      function rebuildAudioGraph() {&#xD;&#xA;        try {&#xD;&#xA;          proc &amp;&amp; proc.disconnect();&#xD;&#xA;        } catch {}&#xD;&#xA;        if (!mediaDest) {&#xD;&#xA;          mediaDest = audioCtx.createMediaStreamDestination();&#xD;&#xA;        }&#xD;&#xA;        proc = audioCtx.createScriptProcessor(SAMPLES, 0, 2);&#xD;&#xA;        proc.onaudioprocess = (e) =&gt; {&#xD;&#xA;          const L = e.outputBuffer.getChannelData(0);&#xD;&#xA;          const R = e.outputBuffer.getChannelData(1);&#xD;&#xA;          const g = muted ? 0 : volume;&#xD;&#xA;          for (let i = 0; i &lt; L.length; i++) {&#xD;&#xA;            const sl = qL.length ? qL.shift() : 0;&#xD;&#xA;            const sr = qR.length ? qR.shift() : 0;&#xD;&#xA;            L[i] = sl * g;&#xD;&#xA;            R[i] = sr * g;&#xD;&#xA;          }&#xD;&#xA;        };&#xD;&#xA;        proc.connect(audioCtx.destination);&#xD;&#xA;        proc.connect(mediaDest);&#xD;&#xA;        for (let i = 0; i &lt; 2048; i++) {&#xD;&#xA;          qL.push(0);&#xD;&#xA;          qR.push(0);&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;      // ------- ËØªÂèñÂ≠òÊ°£ÂêéÁöÑÊÅ¢Â§ç -------&#xD;&#xA;      function afterStateRestore() {&#xD;&#xA;        const wasRunning = running;&#xD;&#xA;        if (wasRunning) {&#xD;&#xA;          running = false;&#xD;&#xA;          if (rafId) cancelAnimationFrame(rafId);&#xD;&#xA;          rafId = null;&#xD;&#xA;        }&#xD;&#xA;        turboHeld = false;&#xD;&#xA;        speed = 1;&#xD;&#xA;        speedSel.value = &#39;1&#39;;&#xD;&#xA;        if (muted) {&#xD;&#xA;          muted = false;&#xD;&#xA;          btnMute.classList.remove(&#39;on&#39;);&#xD;&#xA;          btnMute.textContent = &#39;üîà ÈùôÈü≥&#39;;&#xD;&#xA;        }&#xD;&#xA;        clearAudioQueue();&#xD;&#xA;        try {&#xD;&#xA;          const p = audioCtx?.resume?.();&#xD;&#xA;          if (p &amp;&amp; typeof p.then === &#39;function&#39;) {&#xD;&#xA;            p.then(() =&gt; rebuildAudioGraph());&#xD;&#xA;          } else {&#xD;&#xA;            rebuildAudioGraph();&#xD;&#xA;          }&#xD;&#xA;        } catch {&#xD;&#xA;          rebuildAudioGraph();&#xD;&#xA;        }&#xD;&#xA;        warming = true;&#xD;&#xA;        frames = 0;&#xD;&#xA;        lastTS = performance.now();&#xD;&#xA;        frameAcc = 0;&#xD;&#xA;        warmUpFrames(WARMUP_TOTAL, 8, () =&gt; {&#xD;&#xA;          clearAudioQueue();&#xD;&#xA;          warming = false;&#xD;&#xA;          if (wasRunning) {&#xD;&#xA;            running = true;&#xD;&#xA;            rafId = requestAnimationFrame(loop);&#xD;&#xA;            btnStart.textContent = &#39;ÊöÇÂÅú&#39;;&#xD;&#xA;            btnReset.disabled = false;&#xD;&#xA;          }&#xD;&#xA;        });&#xD;&#xA;      }&#xD;&#xA;      // ------- ÂàùÂßãÂåñ -------&#xD;&#xA;      function init() {&#xD;&#xA;        nes = new window.jsnes.NES({&#xD;&#xA;          onFrame(buf) {&#xD;&#xA;            const d = imageData.data;&#xD;&#xA;            let j = 0;&#xD;&#xA;            for (let i = 0; i &lt; 256 * 240; i++) {&#xD;&#xA;              const px = buf[i] &gt;&gt;&gt; 0;&#xD;&#xA;              if (swapRB) {&#xD;&#xA;                d[j++] = px &amp; 255;&#xD;&#xA;                d[j++] = (px &gt;&gt; 8) &amp; 255;&#xD;&#xA;                d[j++] = (px &gt;&gt; 16) &amp; 255;&#xD;&#xA;              } else {&#xD;&#xA;                d[j++] = (px &gt;&gt; 16) &amp; 255;&#xD;&#xA;                d[j++] = (px &gt;&gt; 8) &amp; 255;&#xD;&#xA;                d[j++] = px &amp; 255;&#xD;&#xA;              }&#xD;&#xA;              d[j++] = 255;&#xD;&#xA;            }&#xD;&#xA;            ctx.putImageData(imageData, 0, 0);&#xD;&#xA;            frames++;&#xD;&#xA;            const now = performance.now();&#xD;&#xA;            if (now - lastTS &gt;= 1000) {&#xD;&#xA;              fpsEl.textContent = `FPS: ${(frames*1000/(now-lastTS)).toFixed(1)}${lastMult!==1?` √ó${lastMult.toFixed(2)}`:&#39;&#39;}`;&#xD;&#xA;              frames = 0;&#xD;&#xA;              lastTS = now;&#xD;&#xA;            }&#xD;&#xA;          },&#xD;&#xA;          onAudioSample(l, r) {&#xD;&#xA;            if (warming || isNon1x()) return;&#xD;&#xA;            qL.push(l);&#xD;&#xA;            qR.push(r);&#xD;&#xA;            if (qL.length &gt; MAX_QUEUE) {&#xD;&#xA;              const drop = qL.length - MAX_QUEUE;&#xD;&#xA;              qL.splice(0, drop);&#xD;&#xA;              qR.splice(0, drop);&#xD;&#xA;            }&#xD;&#xA;          }&#xD;&#xA;        });&#xD;&#xA;        audioCtx = new AC();&#xD;&#xA;        mediaDest = audioCtx.createMediaStreamDestination();&#xD;&#xA;        rebuildAudioGraph();&#xD;&#xA;        audioCtx.onstatechange = () =&gt; {&#xD;&#xA;          if (audioCtx.state === &#39;running&#39;) rebuildAudioGraph();&#xD;&#xA;        };&#xD;&#xA;        applyScale(2);&#xD;&#xA;      }&#xD;&#xA;      // ------- ‰∏ªÂæ™ÁéØ -------&#xD;&#xA;      function loop() {&#xD;&#xA;        try {&#xD;&#xA;          const base = Number(speed) || 1,&#xD;&#xA;            eff = Math.min(6, turboHeld ? base * 2 : base);&#xD;&#xA;          lastMult = eff;&#xD;&#xA;          frameAcc += eff;&#xD;&#xA;          while (frameAcc &gt;= 1) {&#xD;&#xA;            nes.frame();&#xD;&#xA;            frameAcc--;&#xD;&#xA;          }&#xD;&#xA;          pollGamepad(0, padMapP1, padPrevP1, 1);&#xD;&#xA;          pollGamepad(1, padMapP2, padPrevP2, 2);&#xD;&#xA;        } catch (e) {&#xD;&#xA;          pause();&#xD;&#xA;          errEl.textContent = nes.crashMessage || e;&#xD;&#xA;          return;&#xD;&#xA;        }&#xD;&#xA;        rafId = requestAnimationFrame(loop);&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function start() {&#xD;&#xA;        if (running) return;&#xD;&#xA;        running = true;&#xD;&#xA;        errEl.textContent = &#39;&#39;;&#xD;&#xA;        audioCtx?.resume?.();&#xD;&#xA;        frames = 0;&#xD;&#xA;        lastTS = performance.now();&#xD;&#xA;        frameAcc = 0;&#xD;&#xA;        rafId = requestAnimationFrame(loop);&#xD;&#xA;        btnStart.textContent = &#39;ÊöÇÂÅú&#39;;&#xD;&#xA;        btnReset.disabled = false;&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function pause() {&#xD;&#xA;        if (!running) return;&#xD;&#xA;        running = false;&#xD;&#xA;        if (rafId) cancelAnimationFrame(rafId);&#xD;&#xA;        rafId = null;&#xD;&#xA;        btnStart.textContent = &#39;ÂºÄÂßã&#39;;&#xD;&#xA;        clearAudioQueue();&#xD;&#xA;        releaseAll(1, pressedP1);&#xD;&#xA;        releaseAll(2, pressedP2);&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function reset() {&#xD;&#xA;        if (!nes) return;&#xD;&#xA;        const was = running;&#xD;&#xA;        if (was) pause();&#xD;&#xA;        clearAudioQueue();&#xD;&#xA;        try {&#xD;&#xA;          if (lastRomU8) nes.loadROM(lastRomU8);&#xD;&#xA;          else if (lastRomStr) nes.loadROM(lastRomStr);&#xD;&#xA;        } catch (e) {&#xD;&#xA;          errEl.textContent = &#39;ResetÂ§±Ë¥•:&#39; + e;&#xD;&#xA;          return;&#xD;&#xA;        }&#xD;&#xA;        if (was) start();&#xD;&#xA;        else {&#xD;&#xA;          btnReset.disabled = true;&#xD;&#xA;          btnStart.disabled = false;&#xD;&#xA;          btnStart.textContent = &#39;ÂºÄÂßã&#39;;&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;      // ------- ROMÔºàÊú¨Âú∞Êñá‰ª∂Ôºâ -------&#xD;&#xA;      function loadRomFromFile(file) {&#xD;&#xA;        const r = new FileReader();&#xD;&#xA;        r.onload = ev =&gt; {&#xD;&#xA;          const u8 = new Uint8Array(ev.target.result);&#xD;&#xA;          if (!(u8[0] === 0x4E &amp;&amp; u8[1] === 0x45 &amp;&amp; u8[2] === 0x53 &amp;&amp; u8[3] === 0x1A)) {&#xD;&#xA;            errEl.textContent = &#39;‰∏çÊòØÊúâÊïàNES ROM&#39;;&#xD;&#xA;            return;&#xD;&#xA;          }&#xD;&#xA;          try {&#xD;&#xA;            nes.loadROM(u8);&#xD;&#xA;            lastRomU8 = u8;&#xD;&#xA;            lastRomStr = null;&#xD;&#xA;            afterLoad();&#xD;&#xA;          } catch {&#xD;&#xA;            let s = &#39;&#39;;&#xD;&#xA;            for (let i = 0; i &lt; u8.length; i += 0x8000) s += String.fromCharCode.apply(null, u8.subarray(i, i + 0x8000));&#xD;&#xA;            try {&#xD;&#xA;              nes.loadROM(s);&#xD;&#xA;              lastRomU8 = null;&#xD;&#xA;              lastRomStr = s;&#xD;&#xA;              afterLoad();&#xD;&#xA;            } catch (e2) {&#xD;&#xA;              errEl.textContent = &#39;ROMÂä†ËΩΩÂ§±Ë¥•:&#39; + e2;&#xD;&#xA;            }&#xD;&#xA;          }&#xD;&#xA;        };&#xD;&#xA;        r.readAsArrayBuffer(file);&#xD;&#xA;&#xD;&#xA;        function afterLoad() {&#xD;&#xA;          romNameEl.textContent = file.name;&#xD;&#xA;          btnStart.disabled = false;&#xD;&#xA;          btnReset.disabled = true;&#xD;&#xA;          fpsEl.textContent = &#39;FPS: --&#39;;&#xD;&#xA;          errEl.textContent = &#39;&#39;;&#xD;&#xA;          start();&#xD;&#xA;          stage.focus();&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;      // ------- ROMÔºàËøúÁ®ã URLÔºå‰∏ÄÈîÆÂä†ËΩΩÔºâ -------&#xD;&#xA;      async function loadRomFromUrl(url, displayName) {&#xD;&#xA;        try {&#xD;&#xA;          errEl.textContent = &#39;&#39;;&#xD;&#xA;          romNameEl.textContent = &#39;‰∏ãËΩΩ‰∏≠‚Ä¶&#39;;&#xD;&#xA;          const res = await fetch(url, {&#xD;&#xA;            cache: &#39;no-store&#39;&#xD;&#xA;          });&#xD;&#xA;          if (!res.ok) throw new Error(`HTTP ${res.status}`);&#xD;&#xA;          const ab = await res.arrayBuffer();&#xD;&#xA;          const u8 = new Uint8Array(ab);&#xD;&#xA;          const isINES = (u8[0] === 0x4E &amp;&amp; u8[1] === 0x45 &amp;&amp; u8[2] === 0x53 &amp;&amp; u8[3] === 0x1A);&#xD;&#xA;          if (!isINES) throw new Error(&#39;Not a valid NES ROM (missing iNES header)&#39;);&#xD;&#xA;          try {&#xD;&#xA;            nes.loadROM(u8);&#xD;&#xA;            lastRomU8 = u8;&#xD;&#xA;            lastRomStr = null;&#xD;&#xA;          } catch (e1) {&#xD;&#xA;            let s = &#39;&#39;;&#xD;&#xA;            const CHUNK = 0x8000;&#xD;&#xA;            for (let i = 0; i &lt; u8.length; i += CHUNK) {&#xD;&#xA;              s += String.fromCharCode.apply(null, u8.subarray(i, i + CHUNK));&#xD;&#xA;            }&#xD;&#xA;            nes.loadROM(s);&#xD;&#xA;            lastRomU8 = null;&#xD;&#xA;            lastRomStr = s;&#xD;&#xA;          }&#xD;&#xA;          romNameEl.textContent = displayName || (url.split(&#39;/&#39;).pop() || &#39;ROM&#39;);&#xD;&#xA;          btnStart.disabled = false;&#xD;&#xA;          btnReset.disabled = true;&#xD;&#xA;          fpsEl.textContent = &#39;FPS: --&#39;;&#xD;&#xA;          errEl.textContent = &#39;&#39;;&#xD;&#xA;          start();&#xD;&#xA;          stage.focus();&#xD;&#xA;        } catch (e) {&#xD;&#xA;          errEl.textContent = &#39;ROM ‰∏ãËΩΩ/Âä†ËΩΩÂ§±Ë¥•Ôºö&#39; + (e?.message || e);&#xD;&#xA;          console.error(e);&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;      // ------- ÈîÆÁõò -------&#xD;&#xA;      function onKey(e, down) {&#xD;&#xA;        if (!nes) return;&#xD;&#xA;        if (e.code === &#39;Tab&#39;) {&#xD;&#xA;          if (down &amp;&amp; !turboHeld) {&#xD;&#xA;            turboHeld = true;&#xD;&#xA;            clearAudioQueue();&#xD;&#xA;          } else if (!down &amp;&amp; turboHeld) {&#xD;&#xA;            turboHeld = false;&#xD;&#xA;            clearAudioQueue();&#xD;&#xA;          }&#xD;&#xA;          e.preventDefault();&#xD;&#xA;          return;&#xD;&#xA;        }&#xD;&#xA;        for (const [name, code] of Object.entries(keyMapP1)) {&#xD;&#xA;          if (e.code === code) {&#xD;&#xA;            const btn = NES_BUTTONS.find(([n]) =&gt; n === name)[1];&#xD;&#xA;            nes[down ? &#39;buttonDown&#39; : &#39;buttonUp&#39;](1, btn);&#xD;&#xA;            if (down) pressedP1.add(name);&#xD;&#xA;            else pressedP1.delete(name);&#xD;&#xA;            e.preventDefault();&#xD;&#xA;            return;&#xD;&#xA;          }&#xD;&#xA;        }&#xD;&#xA;        for (const [name, code] of Object.entries(keyMapP2)) {&#xD;&#xA;          if (e.code === code) {&#xD;&#xA;            const btn = NES_BUTTONS.find(([n]) =&gt; n === name)[1];&#xD;&#xA;            nes[down ? &#39;buttonDown&#39; : &#39;buttonUp&#39;](2, btn);&#xD;&#xA;            if (down) pressedP2.add(name);&#xD;&#xA;            else pressedP2.delete(name);&#xD;&#xA;            e.preventDefault();&#xD;&#xA;            return;&#xD;&#xA;          }&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function releaseAll(player, set) {&#xD;&#xA;        for (const name of set) {&#xD;&#xA;          const btn = NES_BUTTONS.find(([n]) =&gt; n === name)[1];&#xD;&#xA;          nes.buttonUp(player, btn);&#xD;&#xA;        }&#xD;&#xA;        set.clear();&#xD;&#xA;        if (player === 1) padPrevP1 = stateObj(false);&#xD;&#xA;        else padPrevP2 = stateObj(false);&#xD;&#xA;      }&#xD;&#xA;      // ------- ÊâãÊüÑ -------&#xD;&#xA;      function pollGamepad(index, pm, prev, player) {&#xD;&#xA;        const gps = navigator.getGamepads ? navigator.getGamepads() : [];&#xD;&#xA;        const gp = gps &amp;&amp; gps[index];&#xD;&#xA;        if (!gp) return;&#xD;&#xA;        const axisH = gp.axes[pm.AXIS_H] ?? 0,&#xD;&#xA;          axisV = gp.axes[pm.AXIS_V] ?? 0,&#xD;&#xA;          th = Math.max(0.2, Math.min(1, pm.AXIS_THRESH || 0.4));&#xD;&#xA;        const useDpad = [pm.DPAD_UP, pm.DPAD_DOWN, pm.DPAD_LEFT, pm.DPAD_RIGHT].every(Number.isInteger);&#xD;&#xA;        const now = {&#xD;&#xA;          LEFT: useDpad ? btnPressed(gp, pm.DPAD_LEFT) : (axisH &lt; -th),&#xD;&#xA;          RIGHT: useDpad ? btnPressed(gp, pm.DPAD_RIGHT) : (axisH &gt; th),&#xD;&#xA;          UP: useDpad ? btnPressed(gp, pm.DPAD_UP) : (axisV &lt; -th),&#xD;&#xA;          DOWN: useDpad ? btnPressed(gp, pm.DPAD_DOWN) : (axisV &gt; th),&#xD;&#xA;          A: btnPressed(gp, pm.BTN_A) || btnPressed(gp, pm.ALT_A),&#xD;&#xA;          B: btnPressed(gp, pm.BTN_B) || btnPressed(gp, pm.ALT_B),&#xD;&#xA;          SELECT: btnPressed(gp, pm.BTN_SELECT),&#xD;&#xA;          START: btnPressed(gp, pm.BTN_START),&#xD;&#xA;        };&#xD;&#xA;        for (const [name, pressed] of Object.entries(now)) {&#xD;&#xA;          if (pressed !== prev[name]) {&#xD;&#xA;            const btn = NES_BUTTONS.find(([n]) =&gt; n === name)[1];&#xD;&#xA;            nes[pressed ? &#39;buttonDown&#39; : &#39;buttonUp&#39;](player, btn);&#xD;&#xA;            prev[name] = pressed;&#xD;&#xA;          }&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function btnPressed(gp, idx) {&#xD;&#xA;        const b = gp.buttons[idx];&#xD;&#xA;        return !!(b &amp;&amp; b.pressed);&#xD;&#xA;      }&#xD;&#xA;      // ------- Êà™Âõæ/ÂΩïÂà∂ -------&#xD;&#xA;      function screenshot() {&#xD;&#xA;        const a = document.createElement(&#39;a&#39;);&#xD;&#xA;        a.href = canvas.toDataURL(&#39;image/png&#39;);&#xD;&#xA;        a.download = (romNameEl.textContent || &#39;shot&#39;) + &#39;.png&#39;;&#xD;&#xA;        a.click();&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function setupRecorder() {&#xD;&#xA;        try {&#xD;&#xA;          const cs = canvas.captureStream(60);&#xD;&#xA;          mediaStream = new MediaStream([...cs.getVideoTracks(), ...mediaDest.stream.getAudioTracks()]);&#xD;&#xA;          recorder = new MediaRecorder(mediaStream, {&#xD;&#xA;            mimeType: &#39;video/webm;codecs=vp9,opus&#39;&#xD;&#xA;          });&#xD;&#xA;          recorder.ondataavailable = e =&gt; {&#xD;&#xA;            if (e.data.size) recChunks.push(e.data);&#xD;&#xA;          };&#xD;&#xA;          recorder.onstop = () =&gt; {&#xD;&#xA;            const url = URL.createObjectURL(new Blob(recChunks, {&#xD;&#xA;              type: &#39;video/webm&#39;&#xD;&#xA;            }));&#xD;&#xA;            recChunks = [];&#xD;&#xA;            recDL.href = url;&#xD;&#xA;            recDL.style.display = &#39;inline-block&#39;;&#xD;&#xA;          };&#xD;&#xA;        } catch (e) {&#xD;&#xA;          alert(&#39;ÊµèËßàÂô®‰∏çÊîØÊåÅÂΩïÂà∂Ôºö&#39; + e);&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;      // ====== Â≠òÊ°£ÔºàÂê´ ROM + ËÆæÁΩÆÔºâ======&#xD;&#xA;      function currentSettings() {&#xD;&#xA;        return {&#xD;&#xA;          keyMapP1,&#xD;&#xA;          keyMapP2,&#xD;&#xA;          padMapP1,&#xD;&#xA;          padMapP2,&#xD;&#xA;          swapRB,&#xD;&#xA;          volume,&#xD;&#xA;          muted,&#xD;&#xA;          scale: Number(scaleSel.value) || 2,&#xD;&#xA;          speed: Number(speedSel.value) || 1,&#xD;&#xA;          crt: document.getElementById(&#39;crt&#39;).classList.contains(&#39;on&#39;),&#xD;&#xA;        };&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function applySettings(s) {&#xD;&#xA;        try {&#xD;&#xA;          if (!s) return;&#xD;&#xA;          if (s.keyMapP1) {&#xD;&#xA;            keyMapP1 = s.keyMapP1;&#xD;&#xA;            saveJSON(&#39;jsnes_keymap_p1&#39;, keyMapP1);&#xD;&#xA;          }&#xD;&#xA;          if (s.keyMapP2) {&#xD;&#xA;            keyMapP2 = s.keyMapP2;&#xD;&#xA;            saveJSON(&#39;jsnes_keymap_p2&#39;, keyMapP2);&#xD;&#xA;          }&#xD;&#xA;          if (s.padMapP1) {&#xD;&#xA;            padMapP1 = s.padMapP1;&#xD;&#xA;            saveJSON(&#39;jsnes_padmap_p1&#39;, padMapP1);&#xD;&#xA;          }&#xD;&#xA;          if (s.padMapP2) {&#xD;&#xA;            padMapP2 = s.padMapP2;&#xD;&#xA;            saveJSON(&#39;jsnes_padmap_p2&#39;, padMapP2);&#xD;&#xA;          }&#xD;&#xA;          if (typeof s.swapRB === &#39;boolean&#39;) {&#xD;&#xA;            swapRB = s.swapRB;&#xD;&#xA;            document.getElementById(&#39;swap&#39;).classList.toggle(&#39;on&#39;, swapRB);&#xD;&#xA;          }&#xD;&#xA;          if (typeof s.volume === &#39;number&#39;) {&#xD;&#xA;            volume = Math.max(0, Math.min(1, s.volume));&#xD;&#xA;            volEl.value = Math.round(volume * 100);&#xD;&#xA;          }&#xD;&#xA;          if (typeof s.muted === &#39;boolean&#39;) {&#xD;&#xA;            muted = s.muted;&#xD;&#xA;            btnMute.classList.toggle(&#39;on&#39;, muted);&#xD;&#xA;            btnMute.textContent = muted ? &#39;üîá Â∑≤ÈùôÈü≥&#39; : &#39;üîà ÈùôÈü≥&#39;;&#xD;&#xA;          }&#xD;&#xA;          if (typeof s.scale === &#39;number&#39;) applyScale(s.scale);&#xD;&#xA;          if (typeof s.speed === &#39;number&#39;) {&#xD;&#xA;            speed = s.speed;&#xD;&#xA;            speedSel.value = String(s.speed);&#xD;&#xA;          }&#xD;&#xA;          const crtOn = !!s.crt;&#xD;&#xA;          document.getElementById(&#39;crt&#39;).classList.toggle(&#39;on&#39;, crtOn);&#xD;&#xA;          stage.classList.toggle(&#39;crt&#39;, crtOn);&#xD;&#xA;        } catch (e) {&#xD;&#xA;          console.warn(&#39;applySettings error&#39;, e);&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function saveState() {&#xD;&#xA;        try {&#xD;&#xA;          const core = nes.toJSON?.();&#xD;&#xA;          if (!core) return alert(&#39;ÂΩìÂâçÊûÑÂª∫‰∏çÊîØÊåÅ‰øùÂ≠ò&#39;);&#xD;&#xA;          const romU8 = lastRomU8 ? lastRomU8 :&#xD;&#xA;            (lastRomStr ? binStrToU8(lastRomStr) : null);&#xD;&#xA;          const romHash = romU8 ? fnv1aHex(romU8) : null;&#xD;&#xA;          const romName = romNameEl.textContent || &#39;&#39;;&#xD;&#xA;          const payload = {&#xD;&#xA;            version: 2,&#xD;&#xA;            createdAt: Date.now(),&#xD;&#xA;            meta: {&#xD;&#xA;              romName,&#xD;&#xA;              romHash,&#xD;&#xA;              settings: currentSettings()&#xD;&#xA;            },&#xD;&#xA;            romU8: romU8 ? u8ToBase64(romU8) : null,&#xD;&#xA;            nesState: core&#xD;&#xA;          };&#xD;&#xA;          try {&#xD;&#xA;            localStorage.setItem(STATE_PREFIX + slotSel.value, JSON.stringify(payload));&#xD;&#xA;            toast(`Â∑≤‰øùÂ≠òÂà∞ÊßΩ #${+slotSel.value+1}${!payload.romU8?&#39;ÔºàÊú™Êê∫Â∏¶ROMÔºâ&#39;:&#39;&#39;}`);&#xD;&#xA;          } catch (e) {&#xD;&#xA;            console.warn(&#39;‰øùÂ≠òË∂ÖÂá∫ÂÆπÈáèÔºåÂõûÈÄÄ‰∏∫Á≤æÁÆÄÂ≠òÊ°£&#39;, e);&#xD;&#xA;            payload.romU8 = null;&#xD;&#xA;            localStorage.setItem(STATE_PREFIX + slotSel.value, JSON.stringify(payload));&#xD;&#xA;            toast(`ÂÆπÈáè‰∏çË∂≥ÔºåÂ∑≤‰ª•Á≤æÁÆÄÊ®°Âºè‰øùÂ≠òÂà∞ÊßΩ #${+slotSel.value+1}`);&#xD;&#xA;          }&#xD;&#xA;        } catch (e) {&#xD;&#xA;          alert(&#39;‰øùÂ≠òÂ§±Ë¥•Ôºö&#39; + e);&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function loadState() {&#xD;&#xA;        try {&#xD;&#xA;          const raw = localStorage.getItem(STATE_PREFIX + slotSel.value);&#xD;&#xA;          if (!raw) return alert(&#39;Ê≠§ÊßΩÊ≤°ÊúâÂ≠òÊ°£&#39;);&#xD;&#xA;          const payload = JSON.parse(raw);&#xD;&#xA;          const wantU8 = payload.romU8 ? base64ToU8(payload.romU8) : null;&#xD;&#xA;          const wantHash = payload.meta?.romHash || null;&#xD;&#xA;          const currU8 = lastRomU8 ? lastRomU8 : (lastRomStr ? binStrToU8(lastRomStr) : null);&#xD;&#xA;          const currHash = currU8 ? fnv1aHex(currU8) : null;&#xD;&#xA;          if (wantU8 &amp;&amp; (!currHash || currHash !== wantHash)) {&#xD;&#xA;            try {&#xD;&#xA;              nes.loadROM(wantU8);&#xD;&#xA;              lastRomU8 = wantU8;&#xD;&#xA;              lastRomStr = null;&#xD;&#xA;              romNameEl.textContent = payload.meta?.romName || &#39;From Save&#39;;&#xD;&#xA;            } catch (e) {&#xD;&#xA;              console.warn(&#39;ÂàáÊç¢Âà∞Â≠òÊ°£ÂÜÖROMÂ§±Ë¥•ÔºåÂ∞ùËØïÂ≠óÁ¨¶‰∏≤ÂõûÈÄÄ&#39;, e);&#xD;&#xA;              const asStr = u8ToBinStr(wantU8);&#xD;&#xA;              nes.loadROM(asStr);&#xD;&#xA;              lastRomU8 = null;&#xD;&#xA;              lastRomStr = asStr;&#xD;&#xA;              romNameEl.textContent = payload.meta?.romName || &#39;From Save&#39;;&#xD;&#xA;            }&#xD;&#xA;          }&#xD;&#xA;          applySettings(payload.meta?.settings);&#xD;&#xA;          if (!nes.fromJSON) return alert(&#39;ÂΩìÂâçÊûÑÂª∫‰∏çÊîØÊåÅËØªÂèñ&#39;);&#xD;&#xA;          nes.fromJSON(payload.nesState);&#xD;&#xA;          afterStateRestore();&#xD;&#xA;          toast(`Â∑≤ËØªÂèñÊßΩ #${+slotSel.value+1}`);&#xD;&#xA;        } catch (e) {&#xD;&#xA;          alert(&#39;ËØªÂèñÂ§±Ë¥•Ôºö&#39; + e);&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function clearState() {&#xD;&#xA;        localStorage.removeItem(STATE_PREFIX + slotSel.value);&#xD;&#xA;        toast(`Â∑≤Ê∏ÖÈô§ÊßΩ #${+slotSel.value+1}`);&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function exportState() {&#xD;&#xA;        try {&#xD;&#xA;          const core = nes.toJSON?.();&#xD;&#xA;          if (!core) return alert(&#39;ÂΩìÂâçÊûÑÂª∫‰∏çÊîØÊåÅÂØºÂá∫&#39;);&#xD;&#xA;          const romU8 = lastRomU8 ? lastRomU8 : (lastRomStr ? binStrToU8(lastRomStr) : null);&#xD;&#xA;          const romHash = romU8 ? fnv1aHex(romU8) : null;&#xD;&#xA;          const romName = romNameEl.textContent || &#39;&#39;;&#xD;&#xA;          const payload = {&#xD;&#xA;            version: 2,&#xD;&#xA;            createdAt: Date.now(),&#xD;&#xA;            meta: {&#xD;&#xA;              romName,&#xD;&#xA;              romHash,&#xD;&#xA;              settings: currentSettings()&#xD;&#xA;            },&#xD;&#xA;            romU8: romU8 ? u8ToBase64(romU8) : null,&#xD;&#xA;            nesState: core&#xD;&#xA;          };&#xD;&#xA;          const b = new Blob([JSON.stringify(payload)], {&#xD;&#xA;            type: &#39;application/json&#39;&#xD;&#xA;          });&#xD;&#xA;          const a = document.createElement(&#39;a&#39;);&#xD;&#xA;          const base = (romName || &#39;state&#39;).replace(/\.[^/.]+$/, &#39;&#39;);&#xD;&#xA;          a.href = URL.createObjectURL(b);&#xD;&#xA;          a.download = `${base}.state.json`;&#xD;&#xA;          a.click();&#xD;&#xA;        } catch (e) {&#xD;&#xA;          alert(&#39;ÂØºÂá∫Â§±Ë¥•Ôºö&#39; + e);&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function importStateFromFile(f) {&#xD;&#xA;        const r = new FileReader();&#xD;&#xA;        r.onload = ev =&gt; {&#xD;&#xA;          try {&#xD;&#xA;            const payload = JSON.parse(ev.target.result);&#xD;&#xA;            const wantU8 = payload.romU8 ? base64ToU8(payload.romU8) : null;&#xD;&#xA;            const wantHash = payload.meta?.romHash || null;&#xD;&#xA;            const currU8 = lastRomU8 ? lastRomU8 : (lastRomStr ? binStrToU8(lastRomStr) : null);&#xD;&#xA;            const currHash = currU8 ? fnv1aHex(currU8) : null;&#xD;&#xA;            if (wantU8 &amp;&amp; (!currHash || currHash !== wantHash)) {&#xD;&#xA;              try {&#xD;&#xA;                nes.loadROM(wantU8);&#xD;&#xA;                lastRomU8 = wantU8;&#xD;&#xA;                lastRomStr = null;&#xD;&#xA;              } catch (e) {&#xD;&#xA;                const asStr = u8ToBinStr(wantU8);&#xD;&#xA;                nes.loadROM(asStr);&#xD;&#xA;                lastRomU8 = null;&#xD;&#xA;                lastRomStr = asStr;&#xD;&#xA;              }&#xD;&#xA;              romNameEl.textContent = payload.meta?.romName || f.name.replace(/\.state\.json$/i, &#39;&#39;);&#xD;&#xA;            }&#xD;&#xA;            applySettings(payload.meta?.settings);&#xD;&#xA;            if (!nes.fromJSON) return alert(&#39;ÂΩìÂâçÊûÑÂª∫‰∏çÊîØÊåÅËØªÂèñ&#39;);&#xD;&#xA;            nes.fromJSON(payload.nesState);&#xD;&#xA;            afterStateRestore();&#xD;&#xA;            toast(&#39;Â∑≤‰ªéÊñá‰ª∂ÂØºÂÖ•Â≠òÊ°£&#39;);&#xD;&#xA;          } catch (e) {&#xD;&#xA;            alert(&#39;ÂØºÂÖ•Â§±Ë¥•Ôºö&#39; + e);&#xD;&#xA;          }&#xD;&#xA;        };&#xD;&#xA;        r.readAsText(f);&#xD;&#xA;      }&#xD;&#xA;      // ------- Â§ñËßÇ -------&#xD;&#xA;      function applyScale(k) {&#xD;&#xA;        canvas.style.width = 256 * k + &#39;px&#39;;&#xD;&#xA;        canvas.style.height = 240 * k + &#39;px&#39;;&#xD;&#xA;        for (const opt of scaleSel.options) {&#xD;&#xA;          if (+opt.value === k) {&#xD;&#xA;            opt.selected = true;&#xD;&#xA;            break;&#xD;&#xA;          }&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function fitToWindow() {&#xD;&#xA;        const k = Math.max(1, Math.min(Math.floor((innerWidth - 32) / 256), Math.floor((innerHeight - 200) / 240)));&#xD;&#xA;        applyScale(k);&#xD;&#xA;      }&#xD;&#xA;      async function toggleFullscreen() {&#xD;&#xA;        if (document.fullscreenElement) await document.exitFullscreen();&#xD;&#xA;        else await stage.requestFullscreen();&#xD;&#xA;      }&#xD;&#xA;      // ------- ÂèØËßÅÊÄßÊÅ¢Â§ç -------&#xD;&#xA;      document.addEventListener(&#39;visibilitychange&#39;, () =&gt; {&#xD;&#xA;        if (document.hidden) {&#xD;&#xA;          if (running) {&#xD;&#xA;            pausedByVisibility = true;&#xD;&#xA;            pause();&#xD;&#xA;          }&#xD;&#xA;        } else {&#xD;&#xA;          if (pausedByVisibility) {&#xD;&#xA;            pausedByVisibility = false;&#xD;&#xA;            try {&#xD;&#xA;              const p = audioCtx?.resume?.();&#xD;&#xA;              if (p &amp;&amp; typeof p.then === &#39;function&#39;) {&#xD;&#xA;                p.then(() =&gt; rebuildAudioGraph());&#xD;&#xA;              } else {&#xD;&#xA;                rebuildAudioGraph();&#xD;&#xA;              }&#xD;&#xA;            } catch {&#xD;&#xA;              rebuildAudioGraph();&#xD;&#xA;            }&#xD;&#xA;            frames = 0;&#xD;&#xA;            lastTS = performance.now();&#xD;&#xA;            frameAcc = 0;&#xD;&#xA;            running = true;&#xD;&#xA;            rafId = requestAnimationFrame(loop);&#xD;&#xA;            btnStart.textContent = &#39;ÊöÇÂÅú&#39;;&#xD;&#xA;            btnReset.disabled = false;&#xD;&#xA;            btnStart.disabled = false;&#xD;&#xA;            stage.focus();&#xD;&#xA;            if (!warmResumedOnce) {&#xD;&#xA;              warmResumedOnce = true;&#xD;&#xA;              clearAudioQueue();&#xD;&#xA;              warming = true;&#xD;&#xA;              warmUpFrames(24, 6, () =&gt; {&#xD;&#xA;                clearAudioQueue();&#xD;&#xA;                warming = false;&#xD;&#xA;              });&#xD;&#xA;            }&#xD;&#xA;          }&#xD;&#xA;        }&#xD;&#xA;      });&#xD;&#xA;      window.addEventListener(&#39;pageshow&#39;, (e) =&gt; {&#xD;&#xA;        if (e.persisted &amp;&amp; !running) {&#xD;&#xA;          try {&#xD;&#xA;            const p = audioCtx?.resume?.();&#xD;&#xA;            if (p &amp;&amp; typeof p.then === &#39;function&#39;) {&#xD;&#xA;              p.then(() =&gt; rebuildAudioGraph());&#xD;&#xA;            } else {&#xD;&#xA;              rebuildAudioGraph();&#xD;&#xA;            }&#xD;&#xA;          } catch {&#xD;&#xA;            rebuildAudioGraph();&#xD;&#xA;          }&#xD;&#xA;          frames = 0;&#xD;&#xA;          lastTS = performance.now();&#xD;&#xA;          frameAcc = 0;&#xD;&#xA;          running = true;&#xD;&#xA;          rafId = requestAnimationFrame(loop);&#xD;&#xA;          btnStart.textContent = &#39;ÊöÇÂÅú&#39;;&#xD;&#xA;          btnReset.disabled = false;&#xD;&#xA;          stage.focus();&#xD;&#xA;        }&#xD;&#xA;      });&#xD;&#xA;      window.addEventListener(&#39;pagehide&#39;, () =&gt; {&#xD;&#xA;        if (running) {&#xD;&#xA;          pausedByVisibility = true;&#xD;&#xA;          pause();&#xD;&#xA;        }&#xD;&#xA;      });&#xD;&#xA;      window.addEventListener(&#39;focus&#39;, () =&gt; {&#xD;&#xA;        if (!document.hidden) {&#xD;&#xA;          try {&#xD;&#xA;            const p = audioCtx?.resume?.();&#xD;&#xA;            if (p &amp;&amp; typeof p.then === &#39;function&#39;) {&#xD;&#xA;              p.then(() =&gt; rebuildAudioGraph());&#xD;&#xA;            } else {&#xD;&#xA;              rebuildAudioGraph();&#xD;&#xA;            }&#xD;&#xA;          } catch {}&#xD;&#xA;        }&#xD;&#xA;      });&#xD;&#xA;      // ------- ‰∫ã‰ª∂/UI ÁªëÂÆö -------&#xD;&#xA;      romInput.onchange = e =&gt; {&#xD;&#xA;        const f = e.target.files?.[0];&#xD;&#xA;        if (f) {&#xD;&#xA;          romNameEl.textContent = f.name;&#xD;&#xA;          loadRomFromFile(f);&#xD;&#xA;          stage.focus();&#xD;&#xA;        }&#xD;&#xA;      };&#xD;&#xA;      btnStart.onclick = () =&gt; running ? pause() : start();&#xD;&#xA;      btnReset.onclick = reset;&#xD;&#xA;      stage.addEventListener(&#39;keydown&#39;, e =&gt; onKey(e, true));&#xD;&#xA;      stage.addEventListener(&#39;keyup&#39;, e =&gt; onKey(e, false));&#xD;&#xA;      stage.addEventListener(&#39;click&#39;, () =&gt; stage.focus());&#xD;&#xA;      btnMute.onclick = () =&gt; {&#xD;&#xA;        muted = !muted;&#xD;&#xA;        btnMute.classList.toggle(&#39;on&#39;, muted);&#xD;&#xA;        btnMute.textContent = muted ? &#39;üîá Â∑≤ÈùôÈü≥&#39; : &#39;üîà ÈùôÈü≥&#39;;&#xD;&#xA;      };&#xD;&#xA;      volEl.oninput = () =&gt; {&#xD;&#xA;        volume = Math.max(0, Math.min(1, volEl.value / 100));&#xD;&#xA;      };&#xD;&#xA;      scaleSel.onchange = () =&gt; applyScale(Number(scaleSel.value));&#xD;&#xA;      fitBtn.onclick = fitToWindow;&#xD;&#xA;      fsBtn.onclick = toggleFullscreen;&#xD;&#xA;      btnCrt.onclick = () =&gt; {&#xD;&#xA;        btnCrt.classList.toggle(&#39;on&#39;);&#xD;&#xA;        stage.classList.toggle(&#39;crt&#39;, btnCrt.classList.contains(&#39;on&#39;));&#xD;&#xA;      };&#xD;&#xA;      btnSwap.classList.add(&#39;on&#39;);&#xD;&#xA;      btnSwap.onclick = () =&gt; {&#xD;&#xA;        swapRB = !swapRB;&#xD;&#xA;        btnSwap.classList.toggle(&#39;on&#39;, swapRB);&#xD;&#xA;      };&#xD;&#xA;      btnShot.onclick = screenshot;&#xD;&#xA;      speedSel.onchange = () =&gt; {&#xD;&#xA;        speed = Number(speedSel.value) || 1;&#xD;&#xA;        clearAudioQueue();&#xD;&#xA;      }&#xD;&#xA;      document.getElementById(&#39;cfgKeysP1&#39;).onclick = () =&gt; openKeyModal(1);&#xD;&#xA;      document.getElementById(&#39;cfgKeysP2&#39;).onclick = () =&gt; openKeyModal(2);&#xD;&#xA;      restoreKeyDefault.onclick = () =&gt; {&#xD;&#xA;        if (keysTitle.dataset.player === &#39;1&#39;) {&#xD;&#xA;          keyMapP1 = {&#xD;&#xA;            ...defaultKeyMapP1&#xD;&#xA;          };&#xD;&#xA;          saveJSON(&#39;jsnes_keymap_p1&#39;, keyMapP1);&#xD;&#xA;        } else {&#xD;&#xA;          keyMapP2 = {&#xD;&#xA;            ...defaultKeyMapP2&#xD;&#xA;          };&#xD;&#xA;          saveJSON(&#39;jsnes_keymap_p2&#39;, keyMapP2);&#xD;&#xA;        }&#xD;&#xA;        renderKeyGrid(+keysTitle.dataset.player);&#xD;&#xA;      };&#xD;&#xA;      closeKeys.onclick = () =&gt; modalKeys.style.display = &#39;none&#39;;&#xD;&#xA;&#xD;&#xA;      function openKeyModal(p) {&#xD;&#xA;        keysTitle.textContent = `ÈîÆÁõòÊò†Â∞ÑÔºàP${p}Ôºâ`;&#xD;&#xA;        keysTitle.dataset.player = String(p);&#xD;&#xA;        renderKeyGrid(p);&#xD;&#xA;        modalKeys.style.display = &#39;flex&#39;;&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function renderKeyGrid(p) {&#xD;&#xA;        keyGrid.innerHTML = &#39;&#39;;&#xD;&#xA;        const km = p === 1 ? keyMapP1 : keyMapP2;&#xD;&#xA;        for (const [name] of NES_BUTTONS) {&#xD;&#xA;          const row = document.createElement(&#39;div&#39;);&#xD;&#xA;          row.className = &#39;row&#39;;&#xD;&#xA;          const l = document.createElement(&#39;div&#39;);&#xD;&#xA;          l.textContent = name;&#xD;&#xA;          const b = document.createElement(&#39;button&#39;);&#xD;&#xA;          b.className = &#39;kbd&#39;;&#xD;&#xA;          b.textContent = km[name] || &#39;(Êú™ËÆæÁΩÆ)&#39;;&#xD;&#xA;          b.onclick = () =&gt; {&#xD;&#xA;            b.textContent = &#39;‚Ä¶Êåâ‰∏Ä‰∏™ÈîÆ&#39;;&#xD;&#xA;            const h = (e) =&gt; {&#xD;&#xA;              e.preventDefault();&#xD;&#xA;              km[name] = e.code;&#xD;&#xA;              b.textContent = e.code;&#xD;&#xA;              saveJSON(p === 1 ? &#39;jsnes_keymap_p1&#39; : &#39;jsnes_keymap_p2&#39;, km);&#xD;&#xA;              window.removeEventListener(&#39;keydown&#39;, h, true);&#xD;&#xA;            };&#xD;&#xA;            window.addEventListener(&#39;keydown&#39;, h, true);&#xD;&#xA;          };&#xD;&#xA;          row.appendChild(l);&#xD;&#xA;          row.appendChild(b);&#xD;&#xA;          keyGrid.appendChild(row);&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;      document.getElementById(&#39;cfgPadP1&#39;).onclick = () =&gt; openPadModal(1);&#xD;&#xA;      document.getElementById(&#39;cfgPadP2&#39;).onclick = () =&gt; openPadModal(2);&#xD;&#xA;      restorePadDefault.onclick = () =&gt; {&#xD;&#xA;        if (padTitle.dataset.player === &#39;1&#39;) {&#xD;&#xA;          padMapP1 = {&#xD;&#xA;            ...defaultPadMap&#xD;&#xA;          };&#xD;&#xA;          saveJSON(&#39;jsnes_padmap_p1&#39;, padMapP1);&#xD;&#xA;        } else {&#xD;&#xA;          padMapP2 = {&#xD;&#xA;            ...defaultPadMap&#xD;&#xA;          };&#xD;&#xA;          saveJSON(&#39;jsnes_padmap_p2&#39;, padMapP2);&#xD;&#xA;        }&#xD;&#xA;        renderPadGrid(+padTitle.dataset.player);&#xD;&#xA;      };&#xD;&#xA;      closePad.onclick = () =&gt; modalPad.style.display = &#39;none&#39;;&#xD;&#xA;&#xD;&#xA;      function openPadModal(p) {&#xD;&#xA;        padTitle.textContent = `ÊâãÊüÑÊò†Â∞ÑÔºàP${p} = ÊâãÊüÑ${p-1})`;&#xD;&#xA;        padTitle.dataset.player = String(p);&#xD;&#xA;        renderPadGrid(p);&#xD;&#xA;        modalPad.style.display = &#39;flex&#39;;&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function renderPadGrid(p) {&#xD;&#xA;        padGrid.innerHTML = &#39;&#39;;&#xD;&#xA;        const pm = p === 1 ? padMapP1 : padMapP2;&#xD;&#xA;        const items = [&#xD;&#xA;          [&#39;AXIS_H&#39;, &#39;Ê∞¥Âπ≥ËΩ¥Á¥¢Âºï&#39;, pm.AXIS_H],&#xD;&#xA;          [&#39;AXIS_V&#39;, &#39;ÂûÇÁõ¥ËΩ¥Á¥¢Âºï&#39;, pm.AXIS_V],&#xD;&#xA;          [&#39;AXIS_THRESH&#39;, &#39;ËΩ¥ÈòàÂÄº(0.2~1.0)&#39;, pm.AXIS_THRESH],&#xD;&#xA;          [&#39;BTN_A&#39;, &#39;ÊåâÈíÆ A&#39;, pm.BTN_A],&#xD;&#xA;          [&#39;BTN_B&#39;, &#39;ÊåâÈíÆ B&#39;, pm.BTN_B],&#xD;&#xA;          [&#39;ALT_A&#39;, &#39;Â§áÁî® A&#39;, pm.ALT_A],&#xD;&#xA;          [&#39;ALT_B&#39;, &#39;Â§áÁî® B&#39;, pm.ALT_B],&#xD;&#xA;          [&#39;BTN_SELECT&#39;, &#39;ÈÄâÊã©&#39;, pm.BTN_SELECT],&#xD;&#xA;          [&#39;BTN_START&#39;, &#39;ÂºÄÂßã&#39;, pm.BTN_START],&#xD;&#xA;          [&#39;DPAD_UP&#39;, &#39;D-Pad ‰∏ä&#39;, pm.DPAD_UP],&#xD;&#xA;          [&#39;DPAD_DOWN&#39;, &#39;D-Pad ‰∏ã&#39;, pm.DPAD_DOWN],&#xD;&#xA;          [&#39;DPAD_LEFT&#39;, &#39;D-Pad Â∑¶&#39;, pm.DPAD_LEFT],&#xD;&#xA;          [&#39;DPAD_RIGHT&#39;, &#39;D-Pad Âè≥&#39;, pm.DPAD_RIGHT]&#xD;&#xA;        ];&#xD;&#xA;        items.forEach(([key, label, val]) =&gt; {&#xD;&#xA;          const row = document.createElement(&#39;div&#39;);&#xD;&#xA;          row.className = &#39;row&#39;;&#xD;&#xA;          const l = document.createElement(&#39;div&#39;);&#xD;&#xA;          l.textContent = label;&#xD;&#xA;          const v = document.createElement(&#39;span&#39;);&#xD;&#xA;          v.className = &#39;kbd&#39;;&#xD;&#xA;          v.textContent = val;&#xD;&#xA;          const b = document.createElement(&#39;button&#39;);&#xD;&#xA;          b.textContent = &#39;ÊçïÊçâ&#39;;&#xD;&#xA;          b.onclick = () =&gt; {&#xD;&#xA;            b.textContent = &#39;‚Ä¶ÊåâÊâãÊüÑ&#39;;&#xD;&#xA;            capturePadInput(p - 1, (type, idx, val2) =&gt; {&#xD;&#xA;              if (key.startsWith(&#39;AXIS&#39;)) {&#xD;&#xA;                if (type !== &#39;axis&#39;) return false;&#xD;&#xA;                if (key === &#39;AXIS_THRESH&#39;) pm.AXIS_THRESH = Math.max(0.2, Math.min(1, Math.abs(val2 || 0.4)));&#xD;&#xA;                else if (key === &#39;AXIS_H&#39;) pm.AXIS_H = idx;&#xD;&#xA;                else if (key === &#39;AXIS_V&#39;) pm.AXIS_V = idx;&#xD;&#xA;                v.textContent = (key === &#39;AXIS_THRESH&#39;) ? pm.AXIS_THRESH : idx;&#xD;&#xA;              } else {&#xD;&#xA;                if (type !== &#39;button&#39;) return false;&#xD;&#xA;                pm[key] = idx;&#xD;&#xA;                v.textContent = idx;&#xD;&#xA;              }&#xD;&#xA;              saveJSON(p === 1 ? &#39;jsnes_padmap_p1&#39; : &#39;jsnes_padmap_p2&#39;, pm);&#xD;&#xA;              b.textContent = &#39;ÊçïÊçâ&#39;;&#xD;&#xA;              return true;&#xD;&#xA;            });&#xD;&#xA;          };&#xD;&#xA;          row.appendChild(l);&#xD;&#xA;          row.appendChild(v);&#xD;&#xA;          row.appendChild(b);&#xD;&#xA;          padGrid.appendChild(row);&#xD;&#xA;        });&#xD;&#xA;        const tip = document.createElement(&#39;div&#39;);&#xD;&#xA;        tip.className = &#39;tip&#39;;&#xD;&#xA;        tip.textContent = &#39;ÊçïÊçâ‰∏çÂà∞ÔºüÂÖàÊåâ‰∏Ä‰∏ãÊâãÊüÑ‰ªªÊÑèÈîÆÂî§ÈÜíÔºõSafari ÈúÄÂú®‚ÄúÂºÄÂßã‚ÄùËøêË°åÂêéÂÜçÊçïÊçâ„ÄÇ&#39;;&#xD;&#xA;        padGrid.appendChild(tip);&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function capturePadInput(padIndex, onPick) {&#xD;&#xA;        const t0 = performance.now();&#xD;&#xA;        (function tick() {&#xD;&#xA;          const gps = navigator.getGamepads ? navigator.getGamepads() : [];&#xD;&#xA;          const gp = gps &amp;&amp; gps[padIndex];&#xD;&#xA;          if (gp) {&#xD;&#xA;            for (let i = 0; i &lt; gp.buttons.length; i++) {&#xD;&#xA;              if (gp.buttons[i]?.pressed) {&#xD;&#xA;                if (onPick(&#39;button&#39;, i, 1)) return;&#xD;&#xA;              }&#xD;&#xA;            }&#xD;&#xA;            let max = 0,&#xD;&#xA;              idx = 0;&#xD;&#xA;            for (let a = 0; a &lt; gp.axes.length; a++) {&#xD;&#xA;              const v = Math.abs(gp.axes[a]);&#xD;&#xA;              if (v &gt; max) {&#xD;&#xA;                max = v;&#xD;&#xA;                idx = a;&#xD;&#xA;              }&#xD;&#xA;            }&#xD;&#xA;            if (max &gt; 0.3) {&#xD;&#xA;              if (onPick(&#39;axis&#39;, idx, gp.axes[idx])) return;&#xD;&#xA;            }&#xD;&#xA;          }&#xD;&#xA;          if (performance.now() - t0 &lt; 5000) requestAnimationFrame(tick);&#xD;&#xA;        })();&#xD;&#xA;      }&#xD;&#xA;      // ÊãñÊãΩ&#xD;&#xA;      [&#39;dragenter&#39;, &#39;dragover&#39;].forEach(ev =&gt; window.addEventListener(ev, e =&gt; {&#xD;&#xA;        e.preventDefault();&#xD;&#xA;        dropHint.style.display = &#39;flex&#39;;&#xD;&#xA;      }));&#xD;&#xA;      [&#39;dragleave&#39;, &#39;drop&#39;].forEach(ev =&gt; window.addEventListener(ev, e =&gt; {&#xD;&#xA;        e.preventDefault();&#xD;&#xA;        if (ev === &#39;drop&#39;) return;&#xD;&#xA;        dropHint.style.display = &#39;none&#39;;&#xD;&#xA;      }));&#xD;&#xA;      window.addEventListener(&#39;drop&#39;, e =&gt; {&#xD;&#xA;        dropHint.style.display = &#39;none&#39;;&#xD;&#xA;        const f = e.dataTransfer.files?.[0];&#xD;&#xA;        if (!f) return;&#xD;&#xA;        if (/\.(state\.json|json)$/i.test(f.name)) importStateFromFile(f);&#xD;&#xA;        else if (/\.nes$/i.test(f.name)) {&#xD;&#xA;          romNameEl.textContent = f.name;&#xD;&#xA;          loadRomFromFile(f);&#xD;&#xA;          stage.focus();&#xD;&#xA;        } else alert(&#39;‰∏çÊîØÊåÅÁöÑÊñá‰ª∂Á±ªÂûã&#39;);&#xD;&#xA;      });&#xD;&#xA;      // ÂΩïÂà∂&#xD;&#xA;      recStartBtn.onclick = () =&gt; {&#xD;&#xA;        if (!recorder) setupRecorder();&#xD;&#xA;        if (!recorder) return;&#xD;&#xA;        recChunks = [];&#xD;&#xA;        recDL.style.display = &#39;none&#39;;&#xD;&#xA;        recorder.start();&#xD;&#xA;        recStartBtn.disabled = true;&#xD;&#xA;        recStopBtn.disabled = false;&#xD;&#xA;      };&#xD;&#xA;      recStopBtn.onclick = () =&gt; {&#xD;&#xA;        if (recorder &amp;&amp; recorder.state === &#39;recording&#39;) {&#xD;&#xA;          recorder.stop();&#xD;&#xA;          recStartBtn.disabled = false;&#xD;&#xA;          recStopBtn.disabled = true;&#xD;&#xA;        }&#xD;&#xA;      };&#xD;&#xA;      // Â≠òÊ°£ÊåâÈíÆ&#xD;&#xA;      saveBtn.onclick = saveState;&#xD;&#xA;      loadBtn.onclick = loadState;&#xD;&#xA;      clearBtn.onclick = clearState;&#xD;&#xA;      exportBtn.onclick = exportState;&#xD;&#xA;      importInp.onchange = e =&gt; {&#xD;&#xA;        const f = e.target.files?.[0];&#xD;&#xA;        if (f) importStateFromFile(f);&#xD;&#xA;        e.target.value = &#39;&#39;;&#xD;&#xA;      };&#xD;&#xA;      // ‰ª£ÁêÜÊâÄÊúâÂ∏¶ data-rom-url ÁöÑÈìæÊé•ÔºåÁÇπÂáªÂç≥ÂèØÂä†ËΩΩ&#xD;&#xA;      document.addEventListener(&#39;click&#39;, (e) =&gt; {&#xD;&#xA;        const a = e.target.closest(&#39;[data-rom-url]&#39;);&#xD;&#xA;        if (!a) return;&#xD;&#xA;        e.preventDefault();&#xD;&#xA;        const url = a.getAttribute(&#39;data-rom-url&#39;);&#xD;&#xA;        const name = a.getAttribute(&#39;data-rom-name&#39;) || a.textContent.trim() || (url.split(&#39;/&#39;).pop() || &#39;ROM&#39;);&#xD;&#xA;        if (!url) return;&#xD;&#xA;        loadRomFromUrl(url, name);&#xD;&#xA;      });&#xD;&#xA;      // ÂêØÂä®&#xD;&#xA;      init();&#xD;&#xA;      // Âú∞ÂùÄÊ†è ?rom=https://... Ëá™Âä®Âä†ËΩΩ&#xD;&#xA;      (function autoLoadFromQuery() {&#xD;&#xA;        const p = new URLSearchParams(location.search);&#xD;&#xA;        const url = p.get(&#39;rom&#39;);&#xD;&#xA;        if (url) loadRomFromUrl(url, url.split(&#39;/&#39;).pop());&#xD;&#xA;      })();&#xD;&#xA;      // ===== Â∑•ÂÖ∑ÔºöÂìàÂ∏å / ÁºñËß£Á†Å =====&#xD;&#xA;      function fnv1aHex(u8) {&#xD;&#xA;        let h = 0x811c9dc5 | 0;&#xD;&#xA;        for (let i = 0; i &lt; u8.length; i++) {&#xD;&#xA;          h ^= u8[i];&#xD;&#xA;          h = Math.imul(h, 0x01000193);&#xD;&#xA;        }&#xD;&#xA;        return (&#39;00000000&#39; + (h &gt;&gt;&gt; 0).toString(16)).slice(-8);&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function u8ToBase64(u8) {&#xD;&#xA;        let s = &#39;&#39;;&#xD;&#xA;        const CH = 0x8000;&#xD;&#xA;        for (let i = 0; i &lt; u8.length; i += CH) {&#xD;&#xA;          s += String.fromCharCode.apply(null, u8.subarray(i, i + CH));&#xD;&#xA;        }&#xD;&#xA;        return btoa(s);&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function base64ToU8(b64) {&#xD;&#xA;        const s = atob(b64),&#xD;&#xA;          u8 = new Uint8Array(s.length);&#xD;&#xA;        for (let i = 0; i &lt; s.length; i++) u8[i] = s.charCodeAt(i) &amp; 255;&#xD;&#xA;        return u8;&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function binStrToU8(str) {&#xD;&#xA;        const u8 = new Uint8Array(str.length);&#xD;&#xA;        for (let i = 0; i &lt; str.length; i++) u8[i] = str.charCodeAt(i) &amp; 255;&#xD;&#xA;        return u8;&#xD;&#xA;      }&#xD;&#xA;&#xD;&#xA;      function u8ToBinStr(u8) {&#xD;&#xA;        let s = &#39;&#39;;&#xD;&#xA;        const CH = 0x8000;&#xD;&#xA;        for (let i = 0; i &lt; u8.length; i += CH) {&#xD;&#xA;          s += String.fromCharCode.apply(null, u8.subarray(i, i + CH));&#xD;&#xA;        }&#xD;&#xA;        return s;&#xD;&#xA;      }&#xD;&#xA;    })();&#xD;&#xA;  &lt;/script&gt;</description>
    </item>
    <item>
      <title>‰øÑÁΩóÊñØÊñπÂùó</title>
      <link>https://ooyang.cn/game/tetris.htm</link>
      <pubDate>Mon, 29 Dec 2025 11:00:00 +0800</pubDate>
      <guid>https://ooyang.cn/game/tetris.htm</guid>
      <description>&lt;style&gt;&#xD;&#xA;* {margin: 0;padding: 0;box-sizing: border-box;}&#xD;&#xA;.game-container {display: flex;gap: 30px;align-items: flex-start;background-color: #f8f9fa;padding: 25px;border-radius: 12px;box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);}&#xD;&#xA;        #game-board {border: 2px solid #2c3e50;background-color: #f0f0f0;border-radius: 4px;}&#xD;&#xA;        .game-info {display: flex;flex-direction: column;gap: 20px;}&#xD;&#xA;        .info-card {border: 2px solid #2c3e50;padding: 18px;border-radius: 10px;background-color: #ffffff;min-width: 180px;box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);}&#xD;&#xA;        .info-card h3 {margin-bottom: 12px;color: #3498db;text-align: center;font-weight: 600;}&#xD;&#xA;        .info-card p {margin: 8px 0;display: flex;justify-content: space-between;font-size: 15px;}&#xD;&#xA;        .info-card span {color: #2c3e50;font-weight: 500;}&#xD;&#xA;        .control-tips {font-size: 14px;color: #666666;margin-top: 10px;line-height: 1.8;}&#xD;&#xA;        .btn-group {display: flex;gap: 10px;justify-content: center;margin-top: 15px;}&#xD;&#xA;        button {padding: 9px 18px;border: none;border-radius: 6px;background-color: #3498db;color: #ffffff;font-weight: bold;cursor: pointer;transition: all 0.3s;font-size: 14px;}&#xD;&#xA;        button:hover {background-color: #2980b9;transform: translateY(-2px);}&#xD;&#xA;        button:disabled {background-color: #bdc3c7;cursor: not-allowed;transform: none;}&#xD;&#xA;    &lt;/style&gt;&#xD;&#xA;&lt;div class=&#34;game-container&#34;&gt;&#xD;&#xA;        &lt;canvas id=&#34;game-board&#34; width=&#34;300&#34; height=&#34;600&#34;&gt;&lt;/canvas&gt;&#xD;&#xA;        &lt;div class=&#34;game-info&#34;&gt;&#xD;&#xA;            &lt;div class=&#34;info-card&#34;&gt;&#xD;&#xA;                &lt;h3&gt;Ê∏∏ÊàèÊï∞ÊçÆ&lt;/h3&gt;&#xD;&#xA;                &lt;p&gt;ÂæóÂàÜ: &lt;span id=&#34;score&#34;&gt;0&lt;/span&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>ÁªèÂÖ∏Ë¥™ÂêÉËõáÁΩëÈ°µÊ∏∏Êàè</title>
      <link>https://ooyang.cn/game/snake.htm</link>
      <pubDate>Mon, 29 Dec 2025 11:00:00 +0800</pubDate>
      <guid>https://ooyang.cn/game/snake.htm</guid>
      <description>&lt;style&gt;&#xD;&#xA;h1 { color: #2c3e50; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1); }&#xD;&#xA;.game-container { position: relative;&#xD;&#xA;  display: flex;&#xD;&#xA;  flex-direction: column;&#xD;&#xA;  align-items: center;&#xD;&#xA;  justify-content: center;&#xD;&#xA;  gap: 20px;&#xD;&#xA;  margin: 20px 0; /* ÂèØÈÄâÔºåË∞ÉÊï¥‰∏ä‰∏ãÈó¥Ë∑ù */ }&#xD;&#xA;#gameCanvas { border: 5px solid #34495e; border-radius: 8px; background-color: #ecf0f1; }&#xD;&#xA;.game-info { display: flex; justify-content: space-between; width: 400px; font-size: 18px; font-weight: bold; color: #2c3e50; margin-top: 10px; }&#xD;&#xA;.game-tips { color: #7f8c8d; font-size: 14px; text-align: center; }&#xD;&#xA;.game-over-modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: rgba(0, 0, 0, 0.8); color: white; padding: 30px 50px; border-radius: 10px; text-align: center; display: none; z-index: 10; }&#xD;&#xA;.game-over-modal h2 { margin-bottom: 20px; color: #e74c3c; }&#xD;&#xA;.game-over-modal p { margin-bottom: 25px; font-size: 16px; }&#xD;&#xA;.restart-btn { padding: 10px 25px; background-color: #2ecc71; border: none; border-radius: 5px; color: white; font-size: 16px; cursor: pointer; transition: background-color 0.3s; }&#xD;&#xA;.restart-btn:hover { background-color: #27ae60; }&#xD;&#xA;&lt;/style&gt;&#xD;&#xA;&lt;div class=&#34;game-container&#34;&gt;&lt;canvas id=&#34;gameCanvas&#34; width=&#34;400&#34; height=&#34;400&#34;&gt;&lt;/canvas&gt;&#xD;&#xA;        &lt;div class=&#34;game-over-modal&#34; id=&#34;gameOverModal&#34;&gt;&#xD;&#xA;            &lt;h2&gt;Ê∏∏ÊàèÁªìÊùüÔºÅ&lt;/h2&gt;&#xD;&#xA;            &lt;p&gt;‰Ω†ÁöÑÊúÄÁªàÂæóÂàÜÔºö&lt;span id=&#34;finalScore&#34;&gt;0&lt;/span&gt;&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
